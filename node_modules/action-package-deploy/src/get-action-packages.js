#!/usr/bin/env node

const yargs = require("yargs");
const actionApis = require("./action-apis");
const logger = require("./logger");

const options = yargs
    .usage("Usage: -p <PackageId> [-c <CreatorIdFilter>] [-n <PackageNameFilter>]")
    .option("c", { alias: "creator-id", describe: "Action package creator ID filter", type: "string" })
    .option("n", { alias: "package-name", describe: "Action package name filter", type: "string" })
    .option("e", { alias: "endpoint", describe: "Action platform endpoint", type: "string", default: "https://actions.office365.com" })
    .option("l", { alias: "log-level", describe: "Log level", choices: ["status", "info", "debug", "none"], default: "info" })
    .argv;

logger.setLogLevel(options["l"]);

async function getActionPackages(endpoint, creatorId, packageName) {
    var packageMetadataList = await actionApis.getActionPackages(endpoint, creatorId, packageName);
    if (packageMetadataList) {
        logger.logSuccess(`${JSON.stringify(packageMetadataList)}`);
    } else {
        logger.logError(`Error!`);
    }
}

getActionPackages(options["e"], options["c"], options["n"]);